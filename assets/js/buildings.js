buildingGoods = ["Wood", "Stone", "Iron", "Pitch", "Gold"];

buildings = 
[
    {
        "description": "Hovel",
        "health": 100,
        "cost": [
            6,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "House",
        "health": 100,
        "cost": [
            6,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Woodcutter hut",
        "health": 100,
        "cost": [
            3,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Ox tether",
        "health": 100,
        "cost": [
            5,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Iron mine",
        "health": 100,
        "cost": [
            20,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Pitch rig",
        "health": 100,
        "cost": [
            20,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Hunters hut",
        "health": 100,
        "cost": [
            5,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Mercenary post",
        "health": 300,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Barracks",
        "health": 500,
        "cost": [
            0,
            15,
            0,
            0,
            0
        ]
    },
    {
        "description": "Stockpile",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Armory",
        "health": 500,
        "cost": [
            5,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Fletcher",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Blacksmith",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            200
        ]
    },
    {
        "description": "Poleturner",
        "health": 300,
        "cost": [
            10,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Armourer",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Tanner",
        "health": 300,
        "cost": [
            10,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Bakery",
        "health": 300,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Brewery",
        "health": 300,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Granary",
        "health": 300,
        "cost": [
            5,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Quarry",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Quarrypile",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Inn",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Apothecary",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Engineers guild",
        "health": 500,
        "cost": [
            10,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Tunnelers guild",
        "health": 500,
        "cost": [
            10,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Marketplace",
        "health": 300,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Well",
        "health": 300,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "Oil smelter",
        "health": 300,
        "cost": [
            0,
            0,
            10,
            0,
            100
        ]
    },
    {
        "description": "Siege tent",
        "health": 0,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Wheat farm",
        "health": 100,
        "cost": [
            15,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Hop farm",
        "health": 100,
        "cost": [
            15,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Apple farm",
        "health": 100,
        "cost": [
            5,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Dairy farm",
        "health": 100,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Mill",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Stables",
        "health": 300,
        "cost": [
            20,
            0,
            0,
            0,
            400
        ]
    },
    {
        "description": "Chapel",
        "health": 400,
        "cost": [
            0,
            0,
            0,
            0,
            250
        ]
    },
    {
        "description": "Church",
        "health": 800,
        "cost": [
            0,
            0,
            0,
            0,
            500
        ]
    },
    {
        "description": "Cathedral",
        "health": 1200,
        "cost": [
            0,
            0,
            0,
            0,
            1000
        ]
    },
    {
        "description": "Ruins",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keep one",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keep two",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keep three",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keep four",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keep five",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Large gatehouse",
        "health": 2000,
        "cost": [
            0,
            20,
            0,
            0,
            0
        ]
    },
    {
        "description": "Small gatehouse",
        "health": 1000,
        "cost": [
            0,
            10,
            0,
            0,
            0
        ]
    },
    {
        "description": "Main wood",
        "health": 200,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Postern gate",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Drawbridge",
        "health": 0,
        "cost": [
            10,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tunnel",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Campfire",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Signpost",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Parade ground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Fire ballista",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Campground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Parade ground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Parade ground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Parade ground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Parade ground",
        "health": 500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Gatehouse",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Gallows",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            50
        ]
    },
    {
        "description": "Stocks",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            45
        ]
    },
    {
        "description": "Witch hoist",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            40
        ]
    },
    {
        "description": "Maypole",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            25
        ]
    },
    {
        "description": "Garden",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "Killing pit",
        "health": 0,
        "cost": [
            6,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Pitch ditch",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            1,
            0
        ]
    },
    {
        "description": "unused",
        "health": 1000,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Water pot",
        "health": 200,
        "cost": [
            0,
            0,
            0,
            0,
            60
        ]
    },
    {
        "description": "Keepdoor left",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keepdoor right",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Keepdoor",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower one",
        "health": 250,
        "cost": [
            0,
            10,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower two",
        "health": 1000,
        "cost": [
            0,
            10,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower three",
        "health": 1200,
        "cost": [
            0,
            15,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower four",
        "health": 1600,
        "cost": [
            0,
            35,
            0,
            0,
            0
        ]
    },
    {
        "description": "Tower five",
        "health": 2000,
        "cost": [
            0,
            40,
            0,
            0,
            0
        ]
    },
    {
        "description": "unused",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Catapult",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Trebuchet",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Siege tower",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Battering ram",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            150
        ]
    },
    {
        "description": "Portable shield",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            5
        ]
    },
    {
        "description": "unused",
        "health": 0,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Mangonel",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            50
        ]
    },
    {
        "description": "Tower Ballista",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            50
        ]
    },
    {
        "description": "unused",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "unused",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "unused",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Cesspit",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            40
        ]
    },
    {
        "description": "Burning stake",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            45
        ]
    },
    {
        "description": "Gibbet",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            50
        ]
    },
    {
        "description": "Dungeon",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            40
        ]
    },
    {
        "description": "Stretching rack",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            45
        ]
    },
    {
        "description": "Flogging rack",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            50
        ]
    },
    {
        "description": "Chopping block",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            45
        ]
    },
    {
        "description": "Dunking stool",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            40
        ]
    },
    {
        "description": "Dog cage",
        "health": 100,
        "cost": [
            10,
            0,
            0,
            0,
            100
        ]
    },
    {
        "description": "Statue",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "Shrine",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "Bee hive",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "Dancing bear",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            20
        ]
    },
    {
        "description": "Pond",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Bear cave",
        "health": 100,
        "cost": [
            0,
            0,
            0,
            0,
            30
        ]
    },
    {
        "description": "European Outpost",
        "health": 1500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    },
    {
        "description": "Mercenary Outpost",
        "health": 1500,
        "cost": [
            0,
            0,
            0,
            0,
            0
        ]
    }
];


buildingValues = {}

function loadBuildingTable(){
    var cellBorderStyle = "solid thin #000000";
    var tableHeaderBorder = "solid #000000";

    var table = document.createElement("table");
    var header = document.createElement("thead");
    var header_row = document.createElement("tr");

    var cell = document.createElement("th");
    cell.scope = "col";
    cell.style.border = tableHeaderBorder;
    cell.innerText = "Building";
    cell.style.verticalAlign = "bottom";
    header_row.appendChild(cell);

    cell = document.createElement("th");
    cell.scope = "col";
    cell.style.border = tableHeaderBorder;
    cell.innerText = "Health";
    cell.style.verticalAlign = "bottom";
    header_row.appendChild(cell);


    for (var i = 0; i < buildingGoods.length; i++){
        var cell = document.createElement("th");
        cell.scope = "col";
        cell.style.border = tableHeaderBorder;
        cell.innerText = buildingGoods[i];
        header_row.appendChild(cell);
    }
    header.appendChild(header_row);
    table.appendChild(header);

    var body = document.createElement("tbody");
    for (let i = 0; i < buildings.length; i++){
        let buildingName = buildings[i]["description"];

        let row = document.createElement("tr");
        let cell = document.createElement("td");
        cell.scope = "row";    
        cell.style.border = cellBorderStyle;
        cell.innerText = buildingName;
        row.append(cell);

        /* Add building health cell */
        cell = document.createElement("td");
        cell.scope = "row";
        cell.style.border = cellBorderStyle;

        let input = document.createElement("input");
        input.placeholder = buildings[i]["health"]
        input.value = buildings[i]["health"];
        input.type = "number";
        input.min = 0;
        input.max = 4294967295;
        input.style.textAlign = "center";
        cell.appendChild(input);

        var button = document.createElement("button");
        button.classList.add("btn");
        button.classList.add("btn-info");
        button.classList.add("building");
        button.innerText = "Reset";
        button.style.marginLeft = "10px";
        button.addEventListener("click", function(e){
            input.value = input.placeholder;
        });
        cell.append(button);
        row.append(cell);

        /* Define building value retriever */
        buildingValues[buildingName] = {};
        buildingValues[buildingName]["originalHealth"] = () => input.placeholder;
        buildingValues[buildingName]["health"] = () => input.value;
        buildingValues[buildingName]["originalCost"] = [];
        buildingValues[buildingName]["cost"] = [];

        /* Add building cost cells */
        for (let j = 0; j < buildings[i]["cost"].length; j++){
            cell = document.createElement("td");
            cell.scope = "row";
            cell.style.border = cellBorderStyle;

            let input = document.createElement("input");
            input.placeholder = buildings[i]["cost"][j];
            input.value = buildings[i]["cost"][j];
            input.type = "number";
            input.min = 0;
            input.max = 4294967295;
            input.style.textAlign = "center";
            cell.appendChild(input);

            var button = document.createElement("button");
            button.classList.add("btn");
            button.classList.add("btn-info");
            button.classList.add("building");
            button.innerText = "Reset";
            button.style.marginLeft = "10px";
            button.addEventListener("click", function(e){
                input.value = input.placeholder;
            });
            cell.append(button);
            row.append(cell);

            buildingValues[buildingName]["originalCost"].push(() => input.placeholder);
            buildingValues[buildingName]["cost"].push(() => input.value);
        }
        body.append(row);

        buildingValues[buildingName]["value"] = () => {
            let value = {};
            if (!(arrayFunctionEqual(buildingValues[buildingName]["originalCost"], buildingValues[buildingName]["cost"]))){
                value["cost"] = buildingValues[buildingName]["cost"].map(func => func());
            }
            if (buildingValues[buildingName]["originalHealth"]() != buildingValues[buildingName]["health"]()){
                value["health"] = buildingValues[buildingName]["health"]();
            }
            return value;
        };
    }
    table.append(body);
    return table;
}

$("#buildingcontrols").html(loadFilter());
function loadFilter(){
    var container = document.createElement("div");
    container.style.paddingTop = "20px";
    

    var input = document.createElement("input");
    input.placeholder = "Search";
    input.classList.add("form-control");
    input.id = "buildingfilter";
    input.type = "text";
    input.style.display = "inline-block";
    input.style.width = "150px";
    container.append(input);

    var button = document.createElement("button");
    button.classList.add("btn");
    button.classList.add("btn-info");
    button.style.display = "inline-block";
    button.innerText = "Clear filter";
    button.id = "buildingfilterclear";
    container.append(button);

    var button = document.createElement("button");
    button.classList.add("btn");
    button.classList.add("btn-warning");
    button.style.display = "inline-block";
    button.innerText = "Reset all";
    button.style.marginLeft = "20px";
    button.addEventListener("click", function(e){
        document.querySelectorAll(".btn").forEach(btn => {
            if (btn != this && btn.classList.contains("building")){
                btn.click();
            }
        })
    });
    container.append(button);
    return container;
}

$("#buildingfilter").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#buildingtable tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
});

$("#buildingfilterclear").on("click", function() {
    $("#buildingfilter").val("");
    $("#buildingtable tbody tr").filter(function() {
        $(this).show();
    });
});